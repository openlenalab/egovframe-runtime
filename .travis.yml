language: java
jdk:
  - openjdk8

branches:
  only:
    - ci-setting

# Travis CI 서버의 Home
cache:
  directories:
    - $HOME/.m2

# CI 실행 완료시 메일로 알람
notifications:
  email:
    recipients:
      - songyeon0058@gmail.com

addons:
  sonarcloud:
    organization: "openlenalab"
    token:
      secure: $SONAR_TOKEN

# jdk 환경에서 build 후, jdk11 설치하여 sonar 수행
script:
  - mvn -B clean org.jacoco:jacoco-maven-plugin:prepare-agent install org.jacoco:jacoco-maven-plugin:report
  - wget https://github.com/sormuras/bach/raw/master/install-jdk.sh
  - chmod +x $TRAVIS_BUILD_DIR/install-jdk.sh
  - export JAVA_HOME=$HOME/openjdk11
  - $TRAVIS_BUILD_DIR/install-jdk.sh -F 11 --target $JAVA_HOME
  - find ./ -name "%jacoco%"
  - mvn -B sonar:sonar -Dsonar.projectKey=openlenalab_egovframe-runtime  -Dsonar.coverage.jacoco.xmlReportPaths=$(find "$(pwd)" -path '*jacoco.xml' | sed 's/.*/&/' | tr '\n' ',')
